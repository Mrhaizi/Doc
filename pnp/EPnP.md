# EPnP

## 一,须知

Epnp的核心思想是将所有的特征点通过四个控制点加权求和表示出来，然后围绕四个控制点进行一系列的优化和估计.

### 这个算法的已知量为3D坐标系下的特征点和2D像素坐标, 还有相机内参.

## 二,EPnP步骤

### 1, 先选取控制点

​	控制点的选取，先选取所有已知特征点的重心为第一个控制点，然后根据以下图片的步骤求解出其他控制点

![image-20240605162303720](/home/mayuqi/.config/Typora/typora-user-images/image-20240605162303720.png)

​	到此世界坐标系下的四个控制点为已知量.

### 2, 计算加权权重

![微信图片_20240605164511](/home/mayuqi/Desktop/微信图片_20240605164511.jpg)

 一个特征点在不同世界坐标系下对应的加权权重是不变的，以下是证明过程.

![微信图片_20240605165713](/home/mayuqi/Desktop/微信图片_20240605165713.jpg)

![微信图片_20240605165710](/home/mayuqi/Desktop/微信图片_20240605165710.jpg)

### 3，将控制点从世界坐标系转为相机坐标系下

通过rt，可以将世界坐标系下的控制点转到相机坐标系下，又因为加权权重在两个坐标系是不变的，可以得到每个特征点对应相机坐标系下的理论值.

### 4,投影3d到到2d像素平面

因为相机内参是已知的，通过相机模型，可以将相机坐标系下的特征点的理论值，投影到像素坐标系下，得到像素坐标系的理论值。

### 5,误差最优化

通过优化误差函数，最小化所有特征点像素坐标理论值和真实值之间的距离之和求解出RT；

![image-20240605171606199](/home/mayuqi/.config/Typora/typora-user-images/image-20240605171606199.png)
也可以通过最小化特征点在不同坐标系下理论值与实际值的误差的差的和来最优估计
误差定义：
![image-20240605171730144](/home/mayuqi/.config/Typora/typora-user-images/image-20240605171730144.png)
最小化误差
![image-20240605171746635](/home/mayuqi/.config/Typora/typora-user-images/image-20240605171746635.png)
两种方法都是正确的,根据情况自己调整.